<script>
    let cart = [];
    let cartCount = 0;

    function addToCart(name, price) {
        cart.push({ name, price });
        cartCount++;
        updateCartUI();
        updateURL();
    }

    function updateCartUI() {
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        const cartCountElement = document.getElementById('cart-count');

        cartItems.innerHTML = '';
        let total = 0;

        cart.forEach(item => {
            const li = document.createElement('li');
            li.textContent = `${item.name} - $${item.price.toFixed(2)}`;
            cartItems.appendChild(li);
            total += item.price;
        });

        cartTotal.textContent = total.toFixed(2);
        cartCountElement.textContent = cartCount;
    }

    function toggleCart() {
        const popupCart = document.getElementById('popup-cart');
        popupCart.style.display = popupCart.style.display === 'block' ? 'none' : 'block';
    }

    function closeCart() {
        document.getElementById('popup-cart').style.display = 'none';
    }

    function updateURL() {
        const queryString = encodeURIComponent(JSON.stringify(cart));
        window.history.replaceState({}, '', `?cart=${queryString}`);
    }

    function loadCartFromURL() {
        const params = new URLSearchParams(window.location.search);
        const cartData = params.get('cart');
        if (cartData) {
            cart = JSON.parse(decodeURIComponent(cartData));
            cartCount = cart.length;
            updateCartUI();
        }
    }

    window.addEventListener('load', loadCartFromURL);
</script>