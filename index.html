<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Display with Cart</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        header {
            background-color: #007BFF;
            color: white;
            text-align: center;
            padding: 20px 0;
            position: relative;
        }

        header h1 {
            margin: 0;
        }

        .cart-icon {
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        main {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            flex-wrap: wrap; /* Ensures products stack on smaller screens */
        }

        .product {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            width: 45%; /* Adjusted for better responsiveness */
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px; /* Adds spacing between products */
        }

        .product img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .product h2 {
            font-size: 1.5rem;
            margin: 10px 0;
        }

        .product p {
            font-size: 1rem;
            color: #666;
        }

        .product .price {
            font-size: 1.2rem;
            color: #007BFF;
            font-weight: bold;
        }

        .product button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        .product button:hover {
            background-color: #0056b3;
        }

        footer {
            text-align: center;
            padding: 10px 0;
            background-color: #333;
            color: white;
            position: fixed;
            width: 100%;
            bottom: 0;
        }

        /* Popup Cart */
        .popup-cart {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 300px;
            text-align: center;
        }

        .popup-cart ul {
            list-style-type: none;
            padding: 0;
            margin: 10px 0;
        }

        .popup-cart button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .popup-cart button:first-child {
            background-color: #007BFF;
            color: white;
        }

        .popup-cart button:last-child {
            background-color: #ccc;
            color: black;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            main {
                flex-direction: column;
                align-items: center;
            }

            .product {
                width: 90%;
            }
        }

        /* Cart View */
        #cart-view {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        #cart-view ul {
            list-style-type: none;
            padding: 0;
            margin: 10px 0;
        }

        #cart-view button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #cart-view button:first-child {
            background-color: #007BFF;
            color: white;
        }

        #cart-view button:last-child {
            background-color: #ccc;
            color: black;
        }
    </style>
</head>
<body>
    <header>
        <h1>Our Products</h1>
        <div class="cart-icon" onclick="toggleCart()">ðŸ›’ Cart (<span id="cart-count">0</span>)</div>
    </header>

    <!-- Product View -->
    <main id="product-view">
        <div class="product" data-name="Product 1" data-price="19.99">
            <img src="https://via.placeholder.com/150" alt="Product 1">
            <h2>Product 1</h2>
            <p>This is a description of Product 1. It's an amazing product that you will love!</p>
            <p class="price">$19.99</p>
            <button onclick="addToCart('Product 1', 19.99)">Add to Cart</button>
        </div>
        <div class="product" data-name="Product 2" data-price="29.99">
            <img src="https://via.placeholder.com/150" alt="Product 2">
            <h2>Product 2</h2>
            <p>This is a description of Product 2. It's another great product with awesome features!</p>
            <p class="price">$29.99</p>
            <button onclick="addToCart('Product 2', 29.99)">Add to Cart</button>
        </div>
    </main>

    <!-- Cart View -->
    <div id="cart-view">
        <h1>Your Shopping Cart</h1>
        <ul id="checkout-items"></ul>
        <p>Total: $<span id="checkout-total">0.00</span></p>
        <button onclick="checkout()">Checkout</button>
        <button onclick="showProducts()">Continue Shopping</button>
    </div>

    <!-- Popup Cart -->
    <div id="popup-cart" class="popup-cart">
        <h3>Your Cart</h3>
        <ul id="cart-items"></ul>
        <p>Total: $<span id="cart-total">0.00</span></p>
        <button onclick="showCartView()">Checkout</button>
        <button onclick="closeCart()">Close</button>
    </div>

    <footer>
        <p>&copy; 2023 My Store. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        // Initialize Supabase client
        const supabaseUrl = ' https://kxoexwdhzcxmxzygwatq.supabase.co/'; // Replace with your Supabase URL
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4b2V4d2RoemN4bXh6eWd3YXRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk3MDk4MjAsImV4cCI6MjA1NTI4NTgyMH0.wXpVEFOOHHReYwJj6cDltmjy3Ff5MXG75lFhA_8xS78'; // Replace with your Supabase anon key
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        let cart = [];
        let cartCount = 0;

        function addToCart(name, price) {
            cart.push({ name, price });
            cartCount++;
            updateCartUI();
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            const cartCountElement = document.getElementById('cart-count');

            cartItems.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} - $${item.price.toFixed(2)}`;
                cartItems.appendChild(li);
                total += item.price;
            });

            cartTotal.textContent = total.toFixed(2);
            cartCountElement.textContent = cartCount;
        }

        function toggleCart() {
            const popupCart = document.getElementById('popup-cart');
            popupCart.style.display = popupCart.style.display === 'block' ? 'none' : 'block';
        }

        function closeCart() {
            document.getElementById('popup-cart').style.display = 'none';
        }

        function showCartView() {
            document.getElementById('product-view').style.display = 'none';
            document.getElementById('cart-view').style.display = 'flex';

            const checkoutItems = document.getElementById('checkout-items');
            const checkoutTotal = document.getElementById('checkout-total');

            checkoutItems.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} - $${item.price.toFixed(2)}`;
                checkoutItems.appendChild(li);
                total += item.price;
            });

            checkoutTotal.textContent = total.toFixed(2);
        }

        function showProducts() {
            document.getElementById('cart-view').style.display = 'none';
            document.getElementById('product-view').style.display = 'flex';
        }

        async function checkout() {
            // Get user session (if using authentication)
            const { data: { user } } = await supabase.auth.getUser();

            if (!user) {
                alert('Please log in to complete your purchase.');
                return;
            }

            // Prepare order data
            const userId = user.id;
            const items = cart.map(item => ({ name: item.name, price: item.price }));
            const totalPrice = cart.reduce((sum, item) => sum + item.price, 0);

            // Insert order into Supabase
            const { error } = await supabase
                .from('orders')
                .insert([{ user_id: userId, items, total_price: totalPrice }]);

            if (error) {
                console.error('Error saving order:', error);
                alert('There was an error processing your order. Please try again.');
            } else {
                alert('Thank you for your purchase!');
                cart = [];
                cartCount = 0;
                updateCartUI();
                showProducts();
            }
        }
    </script>
</body>
</html>